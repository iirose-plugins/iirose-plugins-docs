# 消息及相关交互报文

本文档详细说明了与 IIROSE 核心消息功能、以及由消息衍生出的各类交互相关的报文格式和解析逻辑。

## 核心消息

### 公屏消息

- **报文流向**: 客户端 `->` 服务器 (发送) / 服务器 `->` 客户端 (接收)

#### 发送格式
```log
{"m":"啊呜~ 这是哪里呢","mc":"614530","i":"134878579237"}
```

#### 接收格式
```log
"1762612113>http://r.iirose.com/i/24/10/11/17/4017-4V.jpg>上学>啊呜~ 这是哪里呢>614530>614530>2>>679a51f1d4893>''1908'60'2,100,0.5>134878579237
```

### 私聊消息

- **报文流向**: 客户端 `->` 服务器 (发送) / 服务器 `->` 客户端 (接收)

#### 发送格式
```log
{"g":"679a67a46f713","m":"echo  你好啊我回复你了","mc":"614530","i":"781685462895"}
```

#### 接收格式
```log
""1762612179>679a67a46f713>小学>cartoon/602178>你好啊我回复你了>ffffff>>da9f9a>2>>212728326559
```

### 广播消息 (弹幕)

> 发送广播消息需要绑定手机号。

- **报文流向**: 客户端 `->` 服务器 (发送) / 服务器 `->` 客户端 (接收)

#### 发送格式
```log
~{"t":"饿啊 测试广播消息","c":"614530","v":0}
```

#### 接收格式
```log
=上学>饿啊 测试广播消息>614530>614530>2>http://r.iirose.com/i/24/10/11/17/4017-4V.jpg>1762413398>679a51f1d4893>>1866>57>2,100,0.5>f160
```

## 消息交互

### 消息撤回（频道）

- **报文流向**: 客户端 `->` 服务器 (请求撤回) / 服务器 `->` 客户端

#### 发送格式 (请求撤回)
```log
v0#535908832441
```

#### 接收格式
```log
v0#679a51f1d4893_535908832441"
```

### 消息撤回（私聊）

- **报文流向**: 客户端 `->` 服务器 (请求撤回) / 服务器 `->` 客户端

#### 发送格式 (请求撤回)
```log
v0*679a67a46f713#781685462895
```

#### 接收格式
```log
v0*679a67a46f713"679a51f1d4893_781685462895
```

### 消息引用

> 引用一条消息的格式为 `被引用消息内容 (_hr) 发送者_消息ID (hr_) 新消息内容`。

#### 发送格式
```log
{"m":"第一条消息 (_hr) 上学_1762414014 (hr_) 第二条消息","mc":"614530","i":"193388427515"}
```

#### 接收格式
```log
"1762414019>http://r.iirose.com/i/24/10/11/17/4017-4V.jpg>上学>第一条消息 (_hr) 上学_1762414014 (hr_) 第二条消息>614530>614530>2>>679a51f1d4893>''1866'57'2,100,0.5>193388427515
```

### 提及用户 (@)

> 提及用户的格式为 ` [*用户名*] `。


:::warning
必须在中括号的外侧两侧 **同时** 拥有空格，才被视作用户的提及元素
:::

#### 发送格式
```log
{"m":" [*小学*]  你好","mc":"614530","i":"231011249357"}
```

#### 接收格式
```log
"1762414122>http://r.iirose.com/i/24/10/11/17/4017-4V.jpg>上学> [*小学*]  你好>614530>614530>2>>679a51f1d4893>''1866'57'2,100,0.5>231011249357
```

### 提及频道

> 提及频道的格式为 ` [_频道ID_] `。

:::warning
必须在中括号的外侧两侧 **同时** 拥有空格，才被视作频道的提及元素
:::

#### 发送格式
```log
{"m":"我们这里是  [_5fdcb9b634621_]  ","mc":"614530","i":"532788685715"}
```

#### 接收格式
```log
"1762414153>http://r.iirose.com/i/24/10/11/17/4017-4V.jpg>上学>我们这里是  [_5fdcb9b634621_]  >614530>614530>2>>679a51f1d4893>''1866'57'2,100,0.5>532788685715
```


## 特殊消息类型

### 匿名消息

> 虽然名为匿名，但服务器下发的数据中包含了发送者的真实信息
> 
> 前端通过特殊处理实现了“匿名”的展示效果而已。

- **报文流向**: 客户端 `->` 服务器 (发送) / 服务器 `->` 客户端 (接收)

#### 发送格式
```log
{"g":"679a67a46f713","m":"你好","st":"@","i":"154935167557"}
```

#### 接收格式
```log
""1762413929>679a51f1d4893>上学>>你好>>@>>>>292047017691
```

## 邮箱与用户动作

:::tip 提示
虽然是邮箱消息

但是功能上与用户交互更相关，因此在这里一并列出。
:::


### 点赞

#### 发送格式
```log
+*68af217fea585 这里是备注
```
客户端好像还不支持点赞备注，但是实测 此参数有效

#### 接收格式
```log
@*anata baka？>cartoon/600264>2>'*>>1762613079>d28ad2
```

### 点踩

#### 发送格式

```log
+!68af217fea585 这里是备注
```

### 关注

#### 发送格式
```log
+#068af217fea585
```

#### 接收格式
```log
@*anata baka？>cartoon/600264>2>'^>>1762613260>d28ad2
```


### 取消关注

#### 发送格式
```log
+#168af217fea585
```
#### 接收格式

不会收到取关消息



### 打分

#### 为别人打分
```log
+_*68af217fea585 77
```

#### 删除对别人的打分
```log
+_*68af217fea585 !
```

#### 接收格式

不会收到被打分/取消打分的消息