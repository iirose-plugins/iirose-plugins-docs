# 登录后初始数据包解析

在客户端成功登录后，IIROSE 服务器会立即下发一个体积非常庞大的初始数据包。

本文档将根据真实的报文样本，详细解析其复杂的多层结构。

:::warning
下文的示例报文 均**添加了换行符**以便理解
:::

## 1. 整体结构：三级分隔符系统

这个数据包采用了一种精妙的三级分隔符系统来组织数据。

- **`%*`**: 标志着整个数据包的开始。
- **`"` (双引号)**: **最高层级**的分隔符。它将整个报文精确地分割成**四个主要部分**。
- **`<`**: **第二层级**的分隔符。在每个主要部分内部，用于分隔单个数据对象（例如一个用户、一个频道）。
- **`>`**: **第三层级**的分隔符。在每个数据对象内部，用于分隔该对象的具体属性字段。

### 四个主要部分

整个大包由 `"` 分隔为以下四个连续的数据块：

1.  **第一部分**: 用户列表
2.  **第二部分**: 频道列表
3.  **第三部分**: 其他用户列表（结构较复杂）
4.  **第四部分**: 登录加载页面所需的数据

#### 示例报文
```log
%*
"http://r.iirose.com/i/25/5/30/10/1326-7X.png
>2
>白狐IDea
>ffffff
>63a882551d807
>n
>
>
>5d918932ed1ed
>
>http://r.iirose.com/i/25/2/5/2/1900-08.png
>
>
>27707
>240
>16,98.3,0.5

<cartoon/600264
>2
>anata baka？
>d28ad2
>5ce6a4b520a90
>n
>
>
>68af217fea585
>
>
>*
>
>41
>3
>0,0,0.5

/* 这里省略更多的用户列表 */

'5b792977089e7
>社区
>32,32,32
>000
>
>://r.iirose.com/i/21/5/21/20/3310-GX.jpg 为您提供各类系统服务&&IIROSE&&0&&system/900003&&1IMod&&&&&&
>1,1536146146
>1

<5b792c73178f2
>住宅
>32,32,32
>000
>
>://r.iirose.com/i/21/5/21/20/3539-BG.jpg 对住宅区房产持有超过2栋的人征收物管费 , 收费标准为阶梯式 :
  小于等于2栋 : 免物管费
  大2栋 : 超过部分收取物管费 ,  超过一栋 8钞/日 , 超过两栋 10钞/日 , 超过三栋 12钞/日 , 假如我有5栋房计算方法为 : 超过部分为3栋,故此,8+10+12,也就是 30钞/日&&IIROSE&&0&&system/900003&&1IMod&&&&&&
>1,1536146147
>1

<5b792cb650749_690a1dec96e12
>ttt
>0,0,0
>2003
>
> &&奶油草莓冰沙&&2&&http://r.iirose.com/i/25/10/25/0/3919-NM.jpg&&&&&&&&
>1,1762270700
>
/* 这里省略更多的房间列表 */

"anata baka？
>2
>d28ad2
>cartoon/600264
>
>
>68af217fea585
>68af217fea585
>
>
>"1762409608
>http://r.iirose.com/i/25/11/4/2/1252-AX.jpg
>月姝
>'3
>s
>000000
>2
>http://r.iirose.com/i/25/7/30/11/4457-I5.jpg
>65f31df7d6293
>0𝓨𝓸𝓾𝓻 𝓹𝓻𝓮𝓯𝓮𝓻𝓮𝓷𝓬𝓮 𝓲𝓼 𝓼𝓪𝓵𝓿𝓪𝓽𝓲𝓸𝓷.''1402'1448'91,62.4,0.85
>
>2

<1762408748
>http://r.iirose.com/i/25/4/11/5/2247-F9.jpg
>远浪
>'3
>s
>ffffff
>0
>
>61c9b9f30a5fe
>0我的小鱼你醒了''3863'1053'64,75.1,0.92
>
>2
/* 这里省略更多的用户列表 */

"
>
>00 

<
>&
>20
>
>10,0
>0
>
>://r.iirose.com/i/22/5/12/8/5051-G5.jpg
>
>
```

## 2. 第一部分：用户列表

这是由第一个 `"` 分隔出的数据块，包含了大量的用户信息。

### 对象结构

每个用户对象由 `<` 开始，内部由 `>` 分隔字段。

#### 字段解析 (示例)
```log
<cartoon/600264
>2
>anata baka？
>d28ad2
>5ce6a4b520a90
>n
>
>
>68af217fea585
>
>
>*
>
>41
>3
>0,0,0.5
```
| 索引 | 可能的含义 |
| :--- | :--------- |
| 0    | 头像       |
| 2    | 用户名     |
| 3    | 颜色       |
| 4    | 房间ID     |
| 8    | 用户UID    |
| ...  | ...        |

---

## 3. 第二部分：频道列表

这是由第二个 `"` 分隔出的数据块，包含了所有频道（房间分区）的信息。

### 对象结构

每个频道对象由 `<` 开始，内部由 `>` 分隔字段。

#### 字段解析 (示例)
```log
<5b792c73178f2
>住宅
>32,32,32
>000
>
>://r.iirose.com/i/21/5/21/20/3539-BG.jpg 对住宅区房产...
>1,1536146147
>1
```
| 索引 | 可能的含义     |
| :--- | :------------- |
| 0    | 频道ID         |
| 1    | 频道名         |
| 5    | 频道背景与简介 |

---

## 4. 第三部分：其他用户列表

这是由第三个 `"` 分隔出的数据块，结构最为复杂和不规则，可能包含了嵌套数据。

### 对象结构

这部分的结构尚不完全明确，需要更多样本进行分析。它似乎以一个用户名开头，而不是 `<`。

#### 结构分析 (待研究)
```log
"anata baka？
>2
>d28ad2
>cartoon/600264
...
>"1762409608
>http://r.iirose.com/i/25/11/4/2/1252-AX.jpg
>月姝
...
```
:::warning 注意
这部分的数据结构非常特殊，解析时需要特别处理。
:::

---

## 5. 第四部分：加载页面数据

这是由第四个 `"` 分隔出的最后一部分数据，用于渲染客户端的加载动画/页面。

### 对象结构

这部分数据同样由 `<` 和 `>` 分隔。

#### 字段解析 (示例)
```log
<
>&
>20
>
>10,0
>0
>
>://r.iirose.com/i/22/5/12/8/5051-G5.jpg
>
>
```
| 索引 | 可能的含义          |
| :--- | :------------------ |
| 7    | 加载页面的背景图URL |